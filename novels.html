<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ميديكال شوب — مستلزمات طبية (نسخة مصححة ومُنظَّمة)</title>
  <meta name="description" content="متجر مستلزمات طبية — نسخة مصححة ومُنظَّمة: بحث فوري، سلة محلية، ثيم نهاري/ليلي، فلترة وتصنيف، استجابة للهاتف — بدون باك-إند (جاهز للربط)." />
  <link rel="icon" href="images/logo.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">  <!-- LottieFiles Player -->  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>  <style>
    /* ==========================
       Global variables & reset
       ========================== */
    :root{
      --main: #1abc9c;             /* أساسي */
      --accent: #0b8f73;           /* ثاني */
      --muted: #6b7280;            /* نص ثانوي */
      --bg: #f6f7f9;               /* خلفية عامة */
      --card: #ffffff;             /* خلفية البطاقات */
      --text: #0f1724;             /* نص */
      --radius: 12px;
      --glass: rgba(255,255,255,0.6);
      --overlay: rgba(0,0,0,0.45);
      --currency: 'د.ب';           /* قابل للتعديل */
    }
    body.dark{
      --bg: #0f1724;
      --card: #121316;
      --text: #e6eef0;
      --glass: rgba(0,0,0,0.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:'Tajawal',sans-serif; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased}
    a{color:inherit; text-decoration:none}

    /* =================
       NAVBAR
       ================= */
    .navbar{position:sticky; top:0; z-index:1200; display:flex; gap:12px; align-items:center; padding:10px 16px; background:linear-gradient(90deg,var(--main),var(--accent)); color:#fff}
    .logo{display:flex; gap:10px; align-items:center}
    .logo img{height:44px; width:44px; object-fit:cover; border-radius:8px; background:#fff; padding:4px}
    .search-box{flex:1; display:flex; gap:10px; background:rgba(255,255,255,0.12); padding:8px 12px; border-radius:10px}
    .search-box input{border:none; background:transparent; color:inherit; outline:none; font-size:15px; width:100%}
    .icons{display:flex; gap:8px; align-items:center}
    .icon-btn{background:transparent; border:none; color:inherit; font-size:18px; cursor:pointer; padding:8px; border-radius:8px}

    /* ================
       Layout (main)
       ================ */
    .container{display:grid; grid-template-columns: 280px 1fr; gap:20px; padding:22px; max-width:1200px; margin:0 auto}
    @media(max-width:920px){ .container{ grid-template-columns: 1fr; padding:12px } }

    /* SIDEBAR */
    .sidebar{background:var(--card); border-radius:12px; padding:16px; height:calc(100vh - 80px); box-shadow:0 8px 30px rgba(2,6,23,0.06); overflow:auto; position:sticky; top:70px}
    .sidebar h3{margin:0 0 8px 0}
    .cat-list a{display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:8px; margin-bottom:8px; transition:background 0.12s}
    .cat-list a.active{background:rgba(0,0,0,0.04)}

    /* MAIN SHOP */
    .top-bar{display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; flex-wrap:wrap; gap:10px}
    .shop-title{font-size:20px; font-weight:700}
    .filters{display:flex; gap:8px; align-items:center}
    .filters select, .filters button{padding:8px 10px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:transparent}

    .grid{display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:18px}

    /* CARD */
    .card{background:var(--card); border-radius:12px; overflow:hidden; display:flex; flex-direction:column; box-shadow:0 6px 20px rgba(2,6,23,0.06); position:relative; transition:transform 0.12s}
    .card:hover{transform:translateY(-6px)}
    .card img{width:100%; height:160px; object-fit:cover}
    .card-body{padding:12px; display:flex; flex-direction:column; gap:8px}
    .card h4{margin:0; font-size:15px; font-weight:600; text-align:right}
    .desc{margin:0; font-size:13px; color:var(--muted); height:40px; overflow:hidden}
    .price-row{display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:auto}
    .price{font-weight:700; font-size:16px}
    .btn-buy{background:var(--main); color:white; border:none; padding:8px 10px; border-radius:8px; cursor:pointer}

    .sale-badge{position:absolute; top:8px; left:8px; width:64px; height:64px; z-index:3}

    /* CART FAB */
    .cart-fab{position:fixed; left:20px; bottom:20px; z-index:1400; background:var(--main); color:white; padding:12px; border-radius:12px; display:flex; gap:10px; align-items:center; cursor:pointer}
    .cart-count{background:rgba(255,255,255,0.12); padding:6px 8px; border-radius:8px; font-weight:700}

    /* MODAL */
    .modal-backdrop{position:fixed; inset:0; background:var(--overlay); display:none; align-items:center; justify-content:center; z-index:1500}
    .modal{width:100%; max-width:720px; background:var(--card); border-radius:12px; padding:16px}
    .cart-list{max-height:380px; overflow:auto; display:flex; flex-direction:column; gap:10px; margin:12px 0}
    .cart-item{display:flex; gap:10px; align-items:center; border-radius:8px; padding:8px; background:rgba(0,0,0,0.03)}
    .cart-item img{width:64px; height:64px; object-fit:cover; border-radius:8px}

    .empty{text-align:center; padding:40px 20px; color:var(--muted)}

    /* accessibility focus */
    .card:focus-within, .cat-list a:focus{outline:2px solid rgba(26,188,156,0.22)}

    @media(max-width:600px){ .card img{height:140px} }

    /* small helpers */
    .small{font-size:13px; color:var(--muted)}
  </style></head>
<body>
  <!-- تنبيه عند تعطيل جافاسكربت -->
  <noscript>
    <div style="background:#ffdede;padding:10px;text-align:center">جافاسكربت معطّل — هذه الصفحة تحتاج جافاسكربت لتعمل بشكل كامل.</div>
  </noscript>  <header class="navbar" role="navigation" aria-label="شريط التنقل الرئيسي">
    <div class="logo">
      <img src="images/logo.png" alt="شعار المتجر" onerror="this.src='images/placeholder.jpg'" />
      <div style="display:flex;flex-direction:column;line-height:1">
        <strong>ميديكال شوب</strong>
        <span class="small">مستلزمات طبية موثوقة</span>
      </div>
    </div><div class="search-box" role="search" aria-label="بحث المنتجات">
  <input id="searchInput" type="search" placeholder="ابحث عن منتج أو فئة أو وصف..." aria-label="حقل البحث" />
  <i class="fa fa-search" aria-hidden="true"></i>
</div>

<div class="icons">
  <button id="themeToggle" class="icon-btn" aria-label="تبديل الوضع" title="تبديل الوضع">
    <lottie-player id="moonAnim" src="animations/moon.json" background="transparent" speed="1" style="width:28px;height:28px;display:block" loop autoplay></lottie-player>
    <lottie-player id="sunAnim" src="animations/sun.json" background="transparent" speed="1" style="width:28px;height:28px;display:none" loop autoplay></lottie-player>
  </button>
  <button id="mobileSidebarBtn" class="icon-btn" aria-controls="sidebar" aria-expanded="false" title="قائمة" style="display:none">☰</button>
</div>

  </header>  <main class="container" role="main">
    <aside class="sidebar" id="sidebar" aria-label="قائمة التصنيفات">
      <h3>التصنيفات</h3>
      <nav class="cat-list" aria-label="فئات المنتجات">
        <!-- سيتم ملئ هذه القائمة ديناميكياً -->
      </nav><hr style="margin:14px 0; opacity:0.08" />

  <div>
    <h3 style="margin-bottom:8px">تصفية حسب السعر</h3>
    <div style="display:flex; gap:8px; align-items:center">
      <input id="minPrice" type="number" placeholder="من" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)" />
      <input id="maxPrice" type="number" placeholder="إلى" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)" />
    </div>
    <button id="applyPrice" style="margin-top:8px;width:100%;padding:10px;border-radius:8px;border:none;background:var(--main);color:white;cursor:pointer">تطبيق</button>
  </div>
</aside>

<section aria-label="قائمة المنتجات" style="min-height:400px">
  <div class="top-bar">
    <div class="shop-title"><i class="fa fa-bag-medical"></i> متجر المستلزمات الطبية</div>
    <div class="filters" aria-hidden="false">
      <select id="sortSelect" aria-label="ترتيب">
        <option value="popular">الأكثر مبيعًا</option>
        <option value="price-asc">الأرخص</option>
        <option value="price-desc">الأغلى</option>
        <option value="new">الأحدث</option>
      </select>
      <button id="clearFilters">مسح الفلاتر</button>
    </div>
  </div>

  <div class="grid" id="productsGrid" aria-live="polite" aria-atomic="true"></div>
</section>

  </main>  <div class="cart-fab" id="cartFab" role="button" aria-label="عرض السلة" tabindex="0">
    <i class="fa fa-shopping-cart"></i>
    <div>سلة التسوق</div>
    <div class="cart-count" id="cartCount">0</div>
  </div>  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="cartTitle">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3 id="cartTitle">سلة التسوق</h3>
        <div style="display:flex;gap:8px;align-items:center">
          <strong id="cartTotal">0</strong>
          <button id="closeModal" class="icon-btn" aria-label="إغلاق">×</button>
        </div>
      </div><div class="cart-list" id="cartList"></div>

  <div style="display:flex;justify-content:space-between;gap:10px;margin-top:12px;align-items:center">
    <div>
      <div class="small">محاكاة الدفع — لا يوجد باك-إند</div>
    </div>
    <div style="display:flex;gap:8px">
      <button id="emptyCart" style="padding:10px 12px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent">تفريغ السلة</button>
      <button id="checkoutBtn" style="padding:10px 12px;border-radius:8px;background:var(--main);color:white;border:none">إتمام الطلب</button>
    </div>
  </div>
</div>

  </div>  <script>
    /* ==========================
       CONFIG / بيانات افتراضية
       ========================== */
    const CURRENCY = 'د.ب'; // غيّر هذا إن أردت العمل بعملة أخرى
    const CART_KEY = 'medical_shop_cart_v2';

    // بيانات المنتجات — قابل للتعديل/الاستبدال بواجهة API لاحقاً
    const PRODUCTS = [
      { id:'p1', title:'معطف طبي قابل للغسل (أزرق)', desc:'قماش مضاد للبقع، عدة مقاسات، مناسب للعيادات.', price:18.5, category:'clothing', img:'images/coat-blue.jpg', stock:50, badge:'', createdAt: '2025-01-10' },
      { id:'p2', title:'جهاز قياس ضغط الدم الرقمي', desc:'شاشة رقمية مع إمكانية حفظ القياسات.', price:34.0, category:'measurement', img:'images/bp-monitor.jpg', stock:25, badge:'new', createdAt: '2025-04-12' },
      { id:'p3', title:'قناع طبي ثلاثي الطبقات (50 قطعة)', desc:'قناع حماية مطابق للمواصفات.', price:9.99, category:'sterile', img:'images/masks.jpg', stock:200, badge:'', createdAt: '2024-11-04' },
      { id:'p4', title:'معقم يدين 500 مل (جل)', desc:'معقم كحولي بتركيز 70% — سريع ومرطب.', price:6.75, category:'sterile', img:'images/hand-sanitizer.jpg', stock:120, badge:'', createdAt: '2025-02-01' },
      { id:'p5', title:'مقعد طبي محمول للعيادات', desc:'قابل للطي، خفيف، سهل التنظيف.', price:48.0, category:'clinic', img:'images/clinic-chair.jpg', stock:8, badge:'sale', createdAt: '2024-09-20' },
      { id:'p6', title:'حقيبة أدوات طبية احترافية', desc:'حافظ واسع وجيوب متعددة لأدوات الطبيب.', price:29.9, category:'accessories', img:'images/medical-bag.jpg', stock:34, badge:'', createdAt: '2025-03-05' }
    ];

    /* ==========================
       Helpers صغيرة
       ========================== */
    function q(sel, ctx=document){ return ctx.querySelector(sel); }
    function qa(sel, ctx=document){ return Array.from(ctx.querySelectorAll(sel)); }
    function fmtCurrency(n){ // بسيط ويمكن تغييره لملفات محلية
      try { return new Intl.NumberFormat('ar-EG', { style:'currency', currency:'BHD' }).format(n).replace('BHD', CURRENCY); }
      catch(e){ return n + ' ' + CURRENCY; }
    }

    /* ==========================
       إدارة السلة (localStorage)
       ========================== */
    let cart = {};
    function loadCart(){ try{ cart = JSON.parse(localStorage.getItem(CART_KEY)) || {}; }catch(e){ cart = {}; } }
    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); renderCartCount(); }

    function addToCart(id, qty=1){ const p = PRODUCTS.find(x=>x.id===id); if(!p) return alert('المنتج غير موجود'); const current = cart[id] || 0; if(current + qty > p.stock) return alert('الكمية المطلوبة تتجاوز المخزون'); cart[id] = current + qty; saveCart(); animateCartFab(); }
    function removeFromCart(id){ delete cart[id]; saveCart(); renderCartModal(); }
    function setQty(id, qty){ const p = PRODUCTS.find(x=>x.id===id); if(!p) return; if(qty <= 0){ removeFromCart(id); return; } if(qty > p.stock) { alert('الكمية المطلوبة تتجاوز المخزون'); return; } cart[id] = qty; saveCart(); renderCartModal(); }
    function emptyCart(){ if(confirm('هل تريد تفريغ السلة؟')){ cart = {}; saveCart(); renderCartModal(); } }

    /* ==========================
       Rendering المنتجات
       ========================== */
    const productsGrid = q('#productsGrid');
    const searchInput = q('#searchInput');
    const sortSelect = q('#sortSelect');

    function renderProducts(list=PRODUCTS){
      productsGrid.innerHTML = '';
      const frag = document.createDocumentFragment();

      list.forEach(p=>{
        const article = document.createElement('article');
        article.className = 'card product-card';
        article.tabIndex = 0;
        article.dataset.id = p.id;

        const badgeHTML = p.badge ? `<div class="sale-badge" data-badge="${p.badge}"></div>` : '';

        article.innerHTML = `
          <div style="position:relative;">
            ${badgeHTML}
            <img src="${p.img}" alt="${escapeHtml(p.title)}" loading="lazy" onerror="this.src='images/placeholder.jpg'" />
          </div>
          <div class="card-body">
            <h4>${escapeHtml(p.title)}</h4>
            <p class="desc">${escapeHtml(p.desc)}</p>
            <div class="price-row">
              <div>
                <div class="price">${fmtCurrency(p.price)}</div>
                <div class="small">المخزون: ${p.stock}</div>
              </div>
              <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-start">
                <button class="btn-buy" data-id="${p.id}"><i class="fa fa-cart-plus"></i> أضف للسلة</button>
                <a href="#" class="small quick-buy" data-id="${p.id}">شراء سريع</a>
              </div>
            </div>
          </div>
        `;

        frag.appendChild(article);
      });

      productsGrid.appendChild(frag);

      // أنشئ badges (لو كانت لوتي متوفرة) وإلا أظهر نص بديل
      qa('.sale-badge').forEach(el=>{
        const badge = el.dataset.badge;
        try{
          // نضع اسم ملف لوتي حسب القيمة (sale.json, new.json)
          const anim = document.createElement('lottie-player');
          anim.setAttribute('src', `animations/${badge}.json`);
          anim.setAttribute('background','transparent');
          anim.setAttribute('speed','1');
          anim.style.width = '64px'; anim.style.height = '64px'; anim.setAttribute('loop',''); anim.setAttribute('autoplay','');
          el.appendChild(anim);
        }catch(e){
          el.textContent = badge.toUpperCase();
        }
      });
    }

    function escapeHtml(t){ return (t+'').replace(/[&<>"]+/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]||c)); }

    /* ==========================
       بحث وفلترة وترتيب — مع debounce
       ========================== */
    function debounce(fn, wait=220){ let t; return (...args)=>{ clearTimeout(t); t = setTimeout(()=>fn.apply(this,args), wait); }; }

    function applyFilters(){
      const qv = (searchInput.value || '').trim().toLowerCase();
      const activeCat = q('.cat-list a.active')?.dataset.filter || 'all';
      const minP = Number(q('#minPrice').value || 0);
      const maxP = Number(q('#maxPrice').value || Infinity);

      let res = PRODUCTS.filter(p=>{
        const matchesQuery = !qv || (p.title + ' ' + p.desc).toLowerCase().includes(qv);
        const matchesCat = (activeCat === 'all') || (p.category === activeCat);
        const matchesPrice = (p.price >= minP) && (p.price <= maxP);
        return matchesQuery && matchesCat && matchesPrice;
      });

      const sort = sortSelect.value;
      if(sort === 'price-asc') res.sort((a,b)=>a.price - b.price);
      else if(sort === 'price-desc') res.sort((a,b)=>b.price - a.price);
      else if(sort === 'new') res.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));

      renderProducts(res);
    }
    const debouncedFilter = debounce(applyFilters, 200);

    /* ==========================
       Sidebar — توليد الفئات وعدد المنتجات
       ========================== */
    function buildCategories(){
      const container = q('.cat-list');
      const cats = { all: { count: PRODUCTS.length, label: 'الكل' } };
      PRODUCTS.forEach(p=>{ cats[p.category] = cats[p.category] || { count:0, label: p.category }; cats[p.category].count++; });

      container.innerHTML = '';

      // ترتيب عرض مُقروء
      const order = ['all','clothing','measurement','sterile','clinic','accessories'];
      order.forEach(key=>{
        if(!cats[key]) return; // تخطى الفئات غير الموجودة
        const a = document.createElement('a');
        a.href='#';
        a.dataset.filter = key;
        a.className = key === 'all' ? 'active' : '';
        a.innerHTML = `${translateCategory(key)} <span class="small">(${cats[key].count})</span>`;
        a.addEventListener('click', e=>{ e.preventDefault(); qa('.cat-list a').forEach(x=>x.classList.remove('active')); a.classList.add('active'); applyFilters(); if(window.innerWidth < 920) closeMobileSidebar(); });
        container.appendChild(a);
      });
    }
    function translateCategory(k){
      return ({ all:'الكل', clothing:'الملابس الطبية', measurement:'أجهزة القياس', sterile:'أدوات التعقيم', clinic:'مستلزمات العيادات', accessories:'إكسسوارات طبية' }[k] || k);
    }

    /* ==========================
       CART UI & Modal
       ========================== */
    const cartFab = q('#cartFab');
    const cartCountEl = q('#cartCount');
    const modalBackdrop = q('#modalBackdrop');
    const cartList = q('#cartList');
    const cartTotalEl = q('#cartTotal');

    function renderCartCount(){
      const totalItems = Object.values(cart).reduce((s,n)=>s+n,0);
      cartCountEl.textContent = totalItems;
    }

    function renderCartModal(){
      cartList.innerHTML = '';
      const keys = Object.keys(cart);
      if(keys.length === 0){ cartList.innerHTML = '<div class="empty">سلة الشراء فارغة</div>'; cartTotalEl.textContent = fmtCurrency(0); renderCartCount(); return; }

      let total = 0;
      keys.forEach(id=>{
        const qty = cart[id];
        const p = PRODUCTS.find(x=>x.id===id);
        if(!p) return;
        const item = document.createElement('div');
        item.className = 'cart-item';
        item.innerHTML = `
          <img src="${p.img}" alt="${escapeHtml(p.title)}" onerror="this.src='images/placeholder.jpg'" />
          <div style="flex:1">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div><strong>${escapeHtml(p.title)}</strong><div class="small">${escapeHtml(p.desc)}</div></div>
              <div class="small">${fmtCurrency(p.price)}</div>
            </div>
            <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
              <div style="display:flex;gap:8px;align-items:center">
                <button class="icon-btn qty-minus" data-id="${id}">−</button>
                <div class="small" style="min-width:32px;text-align:center">${qty}</div>
                <button class="icon-btn qty-plus" data-id="${id}">+</button>
              </div>
              <button class="icon-btn remove-item" data-id="${id}" title="إزالة"><i class="fa fa-trash"></i></button>
            </div>
          </div>
        `;
        cartList.appendChild(item);
        total += p.price * qty;
      });

      // ربط أزرار داخل المودال
      qa('.qty-plus').forEach(b=>b.addEventListener('click', ()=>{ setQty(b.dataset.id, (cart[b.dataset.id]||0) + 1); }));
      qa('.qty-minus').forEach(b=>b.addEventListener('click', ()=>{ setQty(b.dataset.id, (cart[b.dataset.id]||0) - 1); }));
      qa('.remove-item').forEach(b=>b.addEventListener('click', ()=>{ removeFromCart(b.dataset.id); }));

      cartTotalEl.textContent = fmtCurrency(total);
      renderCartCount();
    }

    function openModal(){ renderCartModal(); modalBackdrop.style.display = 'flex'; modalBackdrop.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; }
    function closeModal(){ modalBackdrop.style.display = 'none'; modalBackdrop.setAttribute('aria-hidden','true'); document.body.style.overflow = ''; }

    cartFab.addEventListener('click', openModal);
    cartFab.addEventListener('keydown', e=>{ if(e.key === 'Enter') openModal(); });
    q('#closeModal').addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click', e=>{ if(e.target === modalBackdrop) closeModal(); });
    q('#emptyCart').addEventListener('click', emptyCart);
    q('#checkoutBtn').addEventListener('click', ()=>{ if(Object.keys(cart).length === 0){ alert('سلتك فارغة'); return; } alert('تم إرسال طلبك (محاكاة) — لإكمال الربط أرسل الطلب إلى باك-إند.'); cart = {}; saveCart(); closeModal(); });

    function animateCartFab(){ cartFab.animate([{ transform:'scale(1)' },{ transform:'scale(1.06)' },{ transform:'scale(1)' }], { duration:220 }); }

    /* ==========================
       Events delegation — شراء وشراء سريع
       ========================== */
    productsGrid.addEventListener('click', e=>{
      const buyBtn = e.target.closest('.btn-buy');
      if(buyBtn){ addToCart(buyBtn.dataset.id, 1); return; }
      const quick = e.target.closest('.quick-buy');
      if(quick){ addToCart(quick.dataset.id, 1); openModal(); e.preventDefault(); return; }
    });

    /* ==========================
       Theme Toggle
       ========================== */
    const themeToggle = q('#themeToggle');
    const moonAnim = q('#moonAnim');
    const sunAnim = q('#sunAnim');
    function setTheme(isDark){ document.body.classList.toggle('dark', !!isDark); moonAnim.style.display = isDark ? 'none' : 'block'; sunAnim.style.display = isDark ? 'block' : 'none'; localStorage.setItem('theme', isDark ? 'dark' : 'light'); }
    themeToggle.addEventListener('click', ()=> setTheme(!document.body.classList.contains('dark')));
    if(localStorage.getItem('theme') === 'dark') setTheme(true);

    /* ==========================
       Sidebar for mobile (overlay)
       ========================== */
    const mobileSidebarBtn = q('#mobileSidebarBtn');
    function openMobileSidebar(){ q('#sidebar').style.position = 'fixed'; q('#sidebar').style.top = '0'; q('#sidebar').style.right = '0'; q('#sidebar').style.height = '100vh'; q('#sidebar').style.zIndex = 1600; mobileSidebarBtn.setAttribute('aria-expanded','true'); }
    function closeMobileSidebar(){ q('#sidebar').style.position = ''; q('#sidebar').style.right = ''; q('#sidebar').style.height = ''; mobileSidebarBtn.setAttribute('aria-expanded','false'); }
    mobileSidebarBtn.addEventListener('click', ()=>{ if(mobileSidebarBtn.getAttribute('aria-expanded') === 'true') closeMobileSidebar(); else openMobileSidebar(); });

    // إظهار زر القائمة على الشاشات الصغيرة
    function updateMobileUI(){ if(window.innerWidth < 920){ mobileSidebarBtn.style.display = 'inline-flex'; } else { mobileSidebarBtn.style.display = 'none'; closeMobileSidebar(); } }
    window.addEventListener('resize', updateMobileUI);

    /* ==========================
       Initialization on DOMContentLoaded
       ========================== */
    document.addEventListener('DOMContentLoaded', ()=>{
      // load data
      loadCart();
      buildCategories();
      renderProducts(PRODUCTS);
      renderCartCount();
      updateMobileUI();

      // events
      searchInput.addEventListener('input', debouncedFilter);
      sortSelect.addEventListener('change', applyFilters);
      q('#applyPrice').addEventListener('click', applyFilters);
      q('#clearFilters').addEventListener('click', ()=>{ searchInput.value=''; q('#minPrice').value=''; q('#maxPrice').value=''; qa('.cat-list a').forEach(a=>a.classList.remove('active')); q('.cat-list a[data-filter="all"]').classList.add('active'); applyFilters(); });

      // Delegate keyboard accessibility for cards
      productsGrid.addEventListener('keydown', e=>{ if(e.key === 'Enter'){ const card = e.target.closest('.product-card'); if(card){ const id = card.dataset.id; addToCart(id,1); } } });

      // Fallback صور
      qa('img').forEach(img=> img.addEventListener('error', ()=>{ img.src = 'images/placeholder.jpg'; }));

      // حماية: لو لم تكن ملفات لوتي متوفرة، لا تنهار الصفحة (لا يوجد خطأ بسبب missing file)
      // (lottie-player يُظهر خطأ داخلي لكنه لا يوقف JS، لذا لا حاجة لhandler خاص هنا)
    });

    /* ==========================
       وظائف مساعدة للاختبار
       ========================== */
    // تفريغ الكونسول من الأخطاء المُولَّدة سابقاً (عند إعادة تحميل الصفحة أثناء التطوير)
    if(window.console && console.clear) console.clear();

  </script></body>
                 </html>
